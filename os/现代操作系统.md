# 虚拟内存



## 基于分页的虚拟内存

- 页表是分页机制中的关键部分，记录虚拟也到物理页的映射
- 多级页表，用来满足虚拟内存的要求k级，一个虚拟地址包括虚拟页号和页内偏移量。
  - 虚拟页号分为k个部分
  - 虚拟页号i 对应该地址在第i级页表的中的索引。
  - 如果任意一级的某个条目为空，那么条目对应下一级页表也不需要存在
- AArch64 结构4级页表
  - 虚拟地址低48位参与地址翻译，页表级数位4级，虚拟页大小为4kb
  - 因为页的大小是4kb 2的12次方 = 4kb，那么 ，指针的后低12位可以作为 页内偏移量。
  - 整个页表的的起始地址在一个特殊的寄存器  页表基地址寄存器是 TTBR0_Linux ,0 级别只有一个页表。
  - 每个页表项占用8个字节，用于存储物理地址和相应的访问权限-
  - 8字节地址组成
    - 63到48位  全部为0或者1 硬件要求 可用空间到 2的48次方
    - 47 到 39位  这9在虚拟地址的0级页表的索引值
    -  38-30 位 9位在一级页表的索引值
    - 29-21 位，9位作为在2级页表的索引值